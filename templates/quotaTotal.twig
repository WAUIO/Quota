{% extends 'layout.twig' %}

{% block body %}
    <!--Content LEFT-->
    <div style="display: none">
        <span id="euro_exchange">{{ exchange['euro'] }}</span>
        <span id="dollar_exchange">{{ exchange['dollar'] }}</span>
    </div>
    <br/>
    {% if base_rooms|length > 0 %}
        {% for room in base_rooms %}
            <div class="row">
                <div class="col-xs-8 base_title" id="{{ room.type|replace({' ' : '_'}) }}">Based on {{ room.type }}</div>
                <div class="col-xs-4 row" style="margin: 0!important;">
                    <div class="btn_export export_csv" id="export_csv_{{ room.type|replace({' ' : '_'}) }}"></div>
                    <div class="btn_export export_excel" id="export_excel_{{ room.type|replace({' ' : '_'}) }}"></div>
                    <div class="btn_export export_pdf" id="export_pdf_{{ room.type|replace({' ' : '_'}) }}"></div>
                </div>
            </div>
            {#<button id="export_excel_{{ room.type|replace({' ' : '_'}) }}" class="btn_export btn btn-lg btn-danger clearfix"><span class="fa fa-file-pdf-o"></span> Export to Excel</button>#}
            {#<button id="export_pdf_{{ room.type|replace({' ' : '_'}) }}" class="btn_export btn btn-lg btn-danger clearfix"><span class="fa fa-file-pdf-o"></span> Export to PDF</button>#}
            <div class="calculation_quota">
                <div class="table-editable">
                    <table class="table"
                           id="table_{{ room.type|replace({' ' : '_'}) }}"
                           data-show-export="true"
                           data-show-toggle="true"
                           data-tableexport-display="always">
                        <thead>
                            <tr>
                                <th class="table_header" rowspan="2" colspan="2">Designation</th>
                                <th class="table_header" colspan="{{ prestation.max - prestation.min }}">Pax</th>
                                <th class="table_header col_abs"></th>
                            </tr>
                            <tr>
                                {% for i in prestation.min..prestation.max %}
                                    <th class="tr_value">{{ i }}</th>
                                {% endfor %}
                            </tr>
                        </thead>

                        <tbody>
                            <!--Prestation-->
                            <tr id="tr_prestation_{{ room.type|replace({' ' : '_'}) }}" class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">Prestation</td>
                                <td></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}">{{ prestation.value[i-prestation.min]|roundValue }}</td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>
                            <tr id="tr_margin_prestation" class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">Margin</td>
                                <td class="red"><span id="margin_prestation_{{ room.type|replace({' ' : '_'}) }}" class="taxes" data-loading-text="azertyuiti.....">{{ prestation.margin }}</span><span>%</span></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}">{{ (prestation.value[i-prestation.min] *  prestation.margin /100)|roundValue }}</td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>
                            <tr class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">VAT</td>
                                <td class="red"><span id="taxes_prestation_{{ room.type|replace({' ' : '_'}) }}" class="taxes">{{ prestation.vat }}</span><span>%</span></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}">{{ ((prestation.value[i-prestation.min] * prestation.margin /100) * prestation.vat /100)|roundValue }}</td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>

                            <!-- Room -->
                            <tr id="tr_room_{{ room.type|replace({' ' : '_'}) }}" class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">{{ room.type|capitalize }}</td>
                                <td></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}">{{ room.total['value']|roundValue }}</td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>
                            <tr id="tr_margin_room" class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">Margin</td>
                                <td class="red"><span id="margin_room_{{ room.type|replace({' ' : '_'}) }}" class="taxes">{{ room.margin }}</span><span>%</span></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}">{{ (room.total['value'] *  room.margin /100)|roundValue }}</td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>
                            <tr class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">VAT</td>
                                <td class="red"><span id="taxes_room_{{ room.type|replace({' ' : '_'}) }}" class="taxes">{{ room.vat }}</span><span>%</span></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}">{{ ((room.total['value'] * room.margin /100) * room.vat /100)|roundValue }}</td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>

                            <tr class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">Fees</td>
                                <td><span class="others"></span></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}"></td>
                                {% endfor %}
                                {#<td><span class="table-remove glyphicon glyphicon-remove"></span></td>#}
                            </tr>
                            <tr class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">Guides flight</td>
                                <td class="red"><span class="others"></span></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}"></td>
                                {% endfor %}
                                {#<td><span class="table-remove glyphicon glyphicon-remove"></span></td>#}
                            </tr>
                            <tr class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">Customers flight</td>
                                <td class="red"><span class="others"></span></td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}"></td>
                                {% endfor %}
                                {#<td><span class="table-remove glyphicon glyphicon-remove"></span></td>#}
                            </tr>
                            <tr class="tr_{{ room.type|replace({' ' : '_'}) }}">
                                <td class="designation">Others</td>
                                <td class="red"><span class="others"></span></td>
                                {% for i in prestation.min..prestation.max %}
                                <td class="td_value td_{{ room.type|replace({' ' : '_'}) }}"></td>
                                {% endfor %}
                                {#<td><span class="table-remove glyphicon glyphicon-remove"></span></td>#}
                            </tr>
                            <!-- This is our clonable table line -->
                            {#<tr class="tr_{{ room.type|replace({' ' : '_'}) }} hide">#}
                                {#<td class="designation">Others</td>#}
                                {#<td class="red"><span class=""></span></td>#}
                                {#{% for i in prestation.min..prestation.max %}#}
                                    {#<td class="td_value td_{{ room.type|replace({' ' : '_'}) }}"></td>#}
                                {#{% endfor %}#}
                                {#<td><span class="table-remove glyphicon glyphicon-remove"></span></td>#}
                            {#</tr>#}
                            <tr class="tr_total tr_MGA">
                                <td rowspan="3" class="designation total_designation">TOTAL</td>
                                <td class="devise">MGA</td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value total_{{ room.type|replace({' ' : '_'}) }}"></td>
                                {% endfor %}
                                {#<td><span class="table-add glyphicon glyphicon-plus"></span></td>#}
                            </tr>
                            <tr class="tr_total tr_EUR">
                                <td class="devise">EUR ({{ exchange.euro }} Ar)</td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value total_{{ room.type|replace({' ' : '_'}) }}"></td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>
                            <tr class="tr_total tr_USD">
                                <td class="devise">USD ({{ exchange.dollar }} Ar)</td>
                                {% for i in prestation.min..prestation.max %}
                                    <td class="td_value total_{{ room.type|replace({' ' : '_'}) }}"></td>
                                {% endfor %}
                                {#<td></td>#}
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <hr/>
        {% endfor %}
    {% else %}
        <div class="no_quota">
            No room quotation for this customer !<br/><br/>
            <div class="row">
                <div class="col-xs-12">
                    <div class="col-md-12 add_quotation" onclick="location.href ='/editRoom'">
                        Add room quotation
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
{% endblock body %}

{% if base_rooms|length > 0 %}
    {% block menu_room %}
        <!-- Side Widget Well -->
        <div class="row well">
            <h4>Existing room for this quota</h4>
            {% for room in base_rooms %}
                <div class="base_types">
                    <a class="base_type" href="#{{ (room.content[0]['label']|lower)|replace({' ' : '_'}) }}" >{{ room.content[0]['label'] }}</a>
                </div>
            {% endfor %}
            <div class="add_room_button" data-popup-open="popup-1" onclick="location.href ='/editRoom'">Add room</div>
        </div>

    {% endblock menu_room %}
{% endif %}

{% block scripts %}
<script src="/js/quotaTotal.js"></script>
{% endblock scripts %}
